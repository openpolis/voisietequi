{% extends 'base.html' %}


{% block title %}La tua posizione{% endblock %}

{% block header_scripts %}
    {% regroup risposte_partiti by partito__sigla as liste %}
    <script type="text/javascript">

      {% if utente %}
          var utente = {
              'nickname': '{{ utente.nickname}}',
              'email': '{{ utente.email }}',
              'user_key': '{{ utente.user_key }}'
          };
          var coordinate = {{ coord_utente|default_if_none:'{}'|safe }};
          var risposte_utente = {
          {% for ru in risposte_utente %}{{ ru.domanda.pk }}: {{ ru.risposta_int }}{% if not forloop.last %},{%  endif %}{% endfor %}
          };
      {% endif %}

      var risposte_partiti = {
          {% for lista in liste %}
              '{{ lista.grouper }}': {
                {% for item in lista.list %}'{{ item.domanda }}': {{ item.risposta_int }}{% if not forloop.last %},{%  endif %}{% endfor %}
              }{% if not forloop.last %},{%  endif %}
          {% endfor %}
      };
      var partiti = {
          {% for p in partiti %}
            '{{ p.sigla }}': {
              'name': "{{ p.denominazione }}",
              'url': "{{ p.get_absolute_url }}",
              'coalizione': "{{ p.coalizione.slug }}",
              'colore': "{{ p.coalizione.colore }}",
              'simbolo_url': "{{ p.simbolo.url }}"
            }{% if not forloop.last %},{%  endif %}
          {% endfor %}
      }
    </script>
{% endblock %}




{% block scripts %}
    <script type="text/javascript">
        caricamento_social_share = function() {
            var copy_button = $("#copy-button");
            var clip = new ZeroClipboard( copy_button, {
                moviePath: "{{ STATIC_URL }}js/ZeroClipboard.swf"
            } );
            clip.on( 'complete', function(client, args) {
                copy_button.addClass('btn-success');
            } );
            clip.on( 'mouseover', function(client) {
                copy_button.addClass('btn-info');
            } );

            clip.on( 'mouseout', function(client) {
                copy_button.removeClass('btn-info');
            } );

            $(".code-autoselect").on("mouseup", function () {
                $(this).select();
            })
        }
        {% block generate_dynamic_content %}
            $(document).ready(function() {
                draw_graph(coordinate,"user", true);
                posiziona_distanze_generiche(coordinate, partiti);
                posiziona_label_risposte_utente(risposte_utente, risposte, label_risposte);
                posiziona_loghi(risposte_partiti, risposte_utente, dist, partiti, risposte);
                caricamento_social_share();
            });
        {% endblock %}
    </script>

    <script src="{{ STATIC_URL }}js/dynamicPageContent.js"></script>

    <script src="{{ STATIC_URL }}js/risposteUtente.js?"></script>
    <script src="{{ STATIC_URL }}js/utils.js"></script>
{#    <script src="http://d3js.org/d3.v2.js"></script>#}
    <script src="{{ STATIC_URL }}js/underscore.min.js"></script>
    <script src="{{ STATIC_URL }}js/d3.min.js"></script>
    {#script for the final graph #}
    <script src="{{ STATIC_URL }}js/graph.utils.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/force_labels.js"></script>

    <script type="text/javascript" src="{{ STATIC_URL }}js/ZeroClipboard.min.js"></script>
    {#stili per label e marker del grafico#}
    <style>

        #permalink { cursor: auto; }

        .labelbox {
            color:green;
            opacity:0.8
        }

        .labeltext {
            color:black;
            font-weight:bold;
            text-anchor:middle;
            font-family: Arial, sans-serif;
            text-transform: uppercase;
            font-size: 12px;
        }
        .link {
            stroke:gray;
            stroke-width:0.35
        }
        .connection-line {
            stroke:gray;
            stroke-width:0.5
        }
        .nickname {
            background-color: black;
            color:white;
            font-weight:bold;
            text-anchor:middle;
            font-family: Arial, sans-serif;
            text-transform: uppercase;
            font-size: 12px;
        }



    </style>

{% endblock %}



{% block content %}
    <!-- H1 su sfondo verde -->
    <div class="sfondo-verde">
        <div class="container">
            <div class="testata-interna"><h1>La posizione di <strong id="nome-utente">{{ utente.nickname }}</strong></h1></div>
        </div>
    </div>

    <!-- Grafico su sfondo grigio -->
    <div class="sfondo-grigio">
        <div class="container">
            <div class="row-fluid">
                <div class="span8">
                    <div class="grafico" id="grafico" style="position: relative">
                       <img src="{{ STATIC_URL }}img/grafico/bg_user.jpg" alt="Voi Siete Qui - Openpolis" />
                    </div>
                </div>
                <div class="span4">
                    <div class="box-bianco">
                        <form>
                            <br>
                            <h4>Condividi con i tuoi amici</h4>

                            <!-- AddThis Button BEGIN -->
                            <div id="share-page" class="addthis_toolbox addthis_default_style addthis_32x32_style">
                                <a class="addthis_button_facebook"></a>
                                <a class="addthis_button_twitter"></a>
                                <a class="addthis_button_google_plusone_share"></a>
                                <a class="addthis_button_email"></a>
                                <a class="addthis_button_compact"></a>
                                <a class="addthis_counter addthis_bubble_style"></a>
                            </div>
                            <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5117c0d354e9aed6"></script>

                            <hr>
                            <div class="controls">
                                <h5>Copia il link e condividi.</h5>
                                <div class="input-append">
                                    <input id="permalink" class="code-autoselect" type="text" value="{{ CURRENT_URL }}" readonly="readonly">
                                    <a id="copy-button" class="btn" data-clipboard-target="permalink"><i class="icon-magnet"></i></a>
                                </div>
                            </div>
                            <hr>

                            <div id="pubblica">
                                <h5>Codice da incorporare sul tuo sito.</h5>
                                <textarea name="embed_code" id="embed_code" class="span12 code-autoselect" style="height: 60px; font-size: 12px; font-family: Verdana, sans-serif; line-height: 12px;"><iframe width="512" height="292" src="{{ CURRENT_URL }}?embed=1" frameborder="0"></iframe></textarea>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% block distances %}
        <!-- tabella distanze complessive utente-partito -->
        <div class="container">
            <div class="contenuto">
                <h4>La distanza tra te e le liste elettorali dalla più vicina alla più lontana</h4>
                <div class="tema0">

                    <table class="table table-condensed table7">
                        <thead>
                        <tr>
                            <th class="bianco-tab">Tu</th>
                            <th colspan="6" class="bianco-tab">La distanza dalle altre liste</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td class="grigio-tab">&nbsp;</td>
                            <td class="nero-tab">+ vicino</td>
                            <td class="nero-tab">&nbsp;</td>
                            <td class="nero-tab">&nbsp;</td>
                            <td class="nero-tab">&nbsp;</td>
                            <td class="nero-tab">&nbsp;</td>
                            <td class="nero-tab">+ lontano</td>
                        </tr>
                        <tr>
                            <td class="grigio-tab"></td>
                            <td class="verde01-tab"></td>
                            <td class="verde02-tab"></td>
                            <td class="verde03-tab"></td>
                            <td class="verde04-tab"></td>
                            <td class="verde05-tab"></td>
                            <td class="verde06-tab"></td>
                        </tr>
                        </tbody>
                    </table>

                </div>
            </div>
        </div>

        <!-- tabelle distanze tematiche utente-partito -->
        <div class="container">
            <div class="contenuto">
                <h4>Tema per tema le liste che ti sono vicine e quelle che ti sono lontane</h4>
                <div class="accordion" id="accordion">

                    {% for domanda in domande %}
                        <div class="accordion-group tema">
                            <div class="accordion-heading">
                                <a class="accordion-toggle" data-toggle="collapse" {# data-parent="#accordion" #} href="#collapse{{ forloop.counter }}">
                                    <div class="row-fluid">
                                        <div class="span1"><div class="tema-num"><strong>{{ domanda.ordine }}/</strong>{{ QUESTIONS_COUNT }}</div></div>
                                        <div class="span11"><h1>{{ domanda.testo_html|safe }}</h1></div>
                                    </div>
                                </a>
                            </div>
                            <div id="collapse{{ forloop.counter }}" class="accordion-body collapse">
                                <div class="accordion-inner">

                                    <table class="table table-condensed table7">
                                        <thead>
                                        <tr>
                                            <th class="bianco-tab">La tua posizione</th>
                                            <th colspan="6" class="bianco-tab">La distanza dalle altre liste</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td class="grigio-tab">&nbsp;</td>
                                            <td class="nero-tab">+ vicino</td>
                                            <td class="nero-tab">&nbsp;</td>
                                            <td class="nero-tab">&nbsp;</td>
                                            <td class="nero-tab">&nbsp;</td>
                                            <td class="nero-tab">&nbsp;</td>
                                            <td class="nero-tab">+ lontano</td>
                                        </tr>
                                        <tr class="symbols">
                                            <td class="grigio-tab"></td>
                                            <td class="verde01-tab"></td>
                                            <td class="verde02-tab"></td>
                                            <td class="verde03-tab"></td>
                                            <td class="verde04-tab"></td>
                                            <td class="verde05-tab"></td>
                                            <td class="verde06-tab"></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    {% endfor %}

                </div>
            </div>
        </div>

    {% endblock %}

{% endblock %}

